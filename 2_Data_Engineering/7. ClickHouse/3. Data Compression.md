# Making Data Work Faster and Smarter with ClickHouse Compression  
**How ClickHouse saves memory—and makes you look like a performance wizard!**

---

## Why Compression Matters
When working with data, two things are always important:  
- **Speed** (how fast queries run)  
- **Memory** (how much storage and RAM your data consumes)  

More memory usage often means:  
- Slower queries  
- Higher cloud costs  
- Heavier processing  

**Solution?** Compression. And ClickHouse comes with specialized **codecs** (compression techniques) built exactly for data.  

---

## Why Does Memory Matter?
Think of memory like your **study table**:  
- A cluttered table = harder to work.  
- A neat table = faster and easier work.  

Compressed data helps your system to:  
- Read data faster  
- Use less RAM  
- Perform queries more efficiently  

So, saving memory isn’t just “nice to have”—it’s **essential** for high-performance pipelines.

---

## ClickHouse and Compression: The Smart Duo
ClickHouse uses **specialized codecs** (not generic ZIP-style compression).  
These codecs understand **patterns in data** and store them more efficiently.  

Let’s explore some popular ones.

---

### 🔹 Delta Codec
Stores the **difference between consecutive values** instead of the full value.  

Example:  
Original: 100, 102, 104, 106
Delta: 100, 2, 2, 2

👉 Great for:  
- Auto-incrementing IDs  
- Timestamps  
- Steadily increasing sequences  

```sql
id UInt64 CODEC(Delta, LZ4)
```

### 🔹 DoubleDelta Codec
Takes it a step further by storing the **change in the change**.
Example:
```vbnet
Original:      100, 103, 106, 109
Delta:         100, 3,   3,   3
Double Delta:  100, 3,   0,   0
```
👉 Great for:
- Regular intervals (e.g., sensor readings every 5 mins)
- Sequential logs
  ```sql
  temperature Int32 CODEC(DoubleDelta)
  ```

---
### 🔹 GCD Codec
Uses the Greatest Common Divisor (GCD) to shrink values.
Example:
```makefile
Original:   24, 28, 16, 24, 8
GCD = 4
Compressed: 6, 7, 4, 6, 2
```
👉 Great for:
- Financial data
- Quantities with common units
  ```sql
  amount Int64 CODEC(GCD)
  ```

---
### 🔹 Gorilla Codec
Specialized for time series data (like floating-point values).
Efficiently stores small changes and repeats.
👉 Great for:
- Monitoring systems
- IoT sensor data
- Real-time analytics
```sql
cpu_load Float32 CODEC(Gorilla)
```

---
### Real-World Analogy: Packing Smart
Think of compression like packing a suitcase:
- Roll clothes tightly (Delta compression)
- Stack similar ones together (Gorilla compression)
- Remove duplicates (efficient encoding)
Result? **More fits into less space—and travels faster**.

---
## Hands-On Memory Comparison
Try this experiment in ClickHouse:
### 1. Without Compression
```sql
CREATE TABLE no_compression (
    id UInt64,
    created_at DateTime
) ENGINE = MergeTree
ORDER BY id;
```

### 2. With Compression
```sql
CREATE TABLE with_compression (
    id UInt64 CODEC(Delta, LZ4),
    created_at DateTime CODEC(DoubleDelta, LZ4)
) ENGINE = MergeTree
ORDER BY id;
```

### Insert Data
```sql
INSERT INTO no_compression
SELECT number, now() + number
FROM numbers(1000000);

INSERT INTO with_compression
SELECT number, now() + number
FROM numbers(1000000);
```

### Check Disk Usage
```sql
SELECT
  table,
  formatReadableSize(sum(bytes_on_disk)) AS disk_usage
FROM system.parts
WHERE table IN ('no_compression', 'with_compression')
GROUP BY table;
```
👉 You’ll usually see **30–70% space savings**.
