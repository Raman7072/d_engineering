# 🚀 How Does Docker Work?

Docker is a platform that lets you run applications in isolated environments called **containers**.  
To understand its magic, let’s look at its **architecture and core concepts**.

---

## 🏗️ Docker’s Architecture
- **Docker CLI**: The command-line tool you use (`docker run`, `docker build`).
- **Docker Daemon**: Background service that builds images, runs containers, and manages resources.

👉 Analogy: CLI = You placing an order, Daemon = Kitchen preparing & delivering food.

---

## 📦 Images vs Containers
- **Docker Image**: Blueprint/recipe with instructions & ingredients for the app.
- **Docker Container**: Running instance of an image (the actual cooked meal).  
➡️ Many containers can run from the same image.

**TL;DR** → Image = Build → Container = Run

---

## ⚙️ Core Linux Features Behind Docker

### 1. **Namespaces**
- Provide isolation so each container has its own:
  - Processes (`pid`)
  - Network (`net`)
  - Filesystem (`mnt`)
  - Hostname
- Analogy: Like apartments in the same building, each isolated.

---

### 2. **Control Groups (cgroups)**
- Manage and limit resources (CPU, memory, disk, etc.).
- Prevents one container from hogging everything.
- Analogy: Spending limits 💸 for fair resource use.

---

### 3. **Union File System (UFS)**
- Images are built in **layers** (like a cake):
  - Base OS (Ubuntu)
  - Runtime (Python, etc.)
  - Application files
- UFS stacks layers efficiently → smaller images, faster builds, easy rollbacks.

---

### 4. **Container Runtime**
- Tools like **runc** or **containerd** actually launch containers.
- Responsibilities:
  - Set up namespaces & cgroups
  - Mount layered file system
  - Start the container process  
➡️ Acts like the backstage crew running the show.

---

## 🌐 Networking (Basics)
- Containers get:
  - Their own **IP address**
  - Access to the internet (if allowed)
  - Ability to connect with other containers via custom networks
- Useful for multi-service apps (e.g., Web + DB).

---

## 💾 Volumes
- Containers are **ephemeral** → data disappears when stopped.
- **Volumes** store persistent data **outside the container**:
  - Databases
  - Uploaded files
  - Logs & configs  
➡️ Like a reliable backpack your container carries.

---

## 🧩 Putting It All Together (`docker run`)
1. Docker builds an image using layered **Union File System**.
2. Uses **Namespaces** for isolation.
3. Applies **cgroups** for resource control.
4. Hands over to **container runtime** to launch the container.
➡️ Your app now runs inside a neat, isolated box!

---

## 🔑 Key Takeaways
- You don’t need to master all internals to use Docker.
- Understanding these concepts helps with **troubleshooting** and **confidence**.
- Even senior engineers revisit these fundamentals.

---

# 🖼️ Docker Internals Workflow

                ┌──────────────────────────┐
                │       Docker CLI         │
                │ (docker run / build etc) │
                └────────────┬─────────────┘
                             │
                             ▼
                ┌──────────────────────────┐
                │      Docker Daemon       │
                │ (manages containers &    │
                │  images in background)   │
                └────────────┬─────────────┘
                             │
           ┌─────────────────┼───────────────────┐
           ▼                 ▼                   ▼
   ┌────────────┐     ┌───────────────┐   ┌─────────────────┐
   │  Images    │     │   Volumes     │   │   Networking     │
   │ (Blueprint │     │ (Persistent   │   │ (Virtual IPs,    │
   │  Layers)   │     │   storage)    │   │  Bridges, Links) │
   └─────┬──────┘     └───────────────┘   └─────────┬───────┘
         │                                         │
         ▼                                         ▼
   ┌────────────────────────────────────────────────────┐
   │              Container Runtime (runc/containerd)   │
   │────────────────────────────────────────────────────│
   │  - Sets up Namespaces (Isolation)                  │
   │  - Applies cgroups (Resource limits)               │
   │  - Mounts UnionFS (Layered filesystem)             │
   │  - Starts process inside container                 │
   └────────────────────────────────────────────────────┘
                             │
                             ▼
                ┌──────────────────────────┐
                │      Running App         │
                │ (Isolated Containerized  │
                │     Environment)         │
                └──────────────────────────┘
---

## 📚 Want to Explore More?
- **Namespaces vs Cgroups**
- **Docker Engine Internals**
- **runc & OCI**
